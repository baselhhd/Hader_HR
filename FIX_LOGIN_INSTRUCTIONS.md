# ุฅุตูุงุญ ูุดููุฉ ุชุณุฌูู ุงูุฏุฎูู - RLS Infinite Recursion

## ุงููุดููุฉ ุงูุญุงููุฉ
ุนูุฏ ูุญุงููุฉ ุชุณุฌูู ุงูุฏุฎููุ ูุญุฏุซ ุฎุทุฃ:
```
infinite recursion detected in policy for relation "users"
```

ูุฐุง ูุญุฏุซ ุจุณุจุจ ุฃู RLS policies ุนูู ุฌุฏูู `users` ุชุญุชูู ุนูู circular dependency (ุงุนุชูุงุฏ ุฏุงุฆุฑู).

## ุงูุญู - ุฎุทูุงุช ุงูุชูููุฐ

### ุงูุฎุทูุฉ 1: ุงูุชุญ Supabase Dashboard
1. ุงุฐูุจ ุฅูู: https://supabase.com/dashboard
2. ุณุฌู ุงูุฏุฎูู ุฅูู ูุดุฑูุนู
3. ุงุฎุชุฑ ุงููุดุฑูุน: **Hader HR**

### ุงูุฎุทูุฉ 2: ุงูุชุญ SQL Editor
1. ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉุ ุงุถุบุท ุนูู **SQL Editor**
2. ุงุถุบุท ุนูู **New query** ูุฅูุดุงุก ุงุณุชุนูุงู ุฌุฏูุฏ

### ุงูุฎุทูุฉ 3: ูููุฐ ุงูุณูุฑูุจุช
1. ุงูุณุฎ ูุญุชูู ุงูููู: `scripts/fix-rls-policies.sql`
2. ุงูุตู ุงููุญุชูู ูู SQL Editor
3. ุงุถุบุท ุนูู **Run** ุฃู ุงุถุบุท `Ctrl + Enter`

### ุงูุฎุทูุฉ 4: ุชุญูู ูู ุงููุชูุฌุฉ
ูุฌุจ ุฃู ุชุฑู ุฑุณุงุฆู ูุฌุงุญ ูุฌููุน ุงูุฃูุงูุฑ:
- ALTER TABLE (ุชุนุทูู RLS)
- DROP POLICY (ุญุฐู Policies ุงููุฏููุฉ)
- ALTER TABLE (ุชูุนูู RLS)
- CREATE POLICY (ุฅูุดุงุก Policies ุงูุฌุฏูุฏุฉ)

## ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู ุจุนุฏ ุงูุฅุตูุงุญ

ุจุนุฏ ุชูููุฐ ุงูุณูุฑูุจุชุ ุฌุฑุจ ุชุณุฌูู ุงูุฏุฎูู ุจุฃุญุฏ ุงูุญุณุงุจุงุช ุงูุชุงููุฉ:

### ุญุณุงุจ ููุธู:
- **ุงุณู ุงููุณุชุฎุฏู**: `ahmed_ali`
- **ูููุฉ ุงููุฑูุฑ**: `Test123!`

### ุญุณุงุจ HR:
- **ุงุณู ุงููุณุชุฎุฏู**: `fatima_hr`
- **ูููุฉ ุงููุฑูุฑ**: `Test123!`

### ุญุณุงุจ ูุฏูุฑ ูููุน:
- **ุงุณู ุงููุณุชุฎุฏู**: `khalid_manager`
- **ูููุฉ ุงููุฑูุฑ**: `Test123!`

## ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ

ุฅุฐุง ูู ููุฌุญ ุชุณุฌูู ุงูุฏุฎูู ุจุนุฏ ุชูููุฐ ุงูุณูุฑูุจุชุ ุชุญูู ูู:

1. **ุชุญูู ูู ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**:
   ```bash
   npm run check-db
   ```

2. **ุชุญูู ูู Logs ูู Supabase**:
   - ุงุฐูุจ ุฅูู **Logs** โ **Postgres Logs**
   - ุงุจุญุซ ุนู ุฃู ุฃุฎุทุงุก

3. **ุฃุนุฏ ุชุดุบูู ุงููุดุฑูุน**:
   ```bash
   npm run dev
   ```

## ููุงุญุธุงุช ูููุฉ

โ๏ธ **Policy ุงููุคูุชุฉ ููุชุทููุฑ**:
ุงูุณูุฑูุจุช ูุญุชูู ุนูู policy ุชุณูุญ ูุฃู ุดุฎุต ุจูุฑุงุกุฉ ุฌุฏูู users (ููุชุณุฌูู ุงูุฏุฎูู):
```sql
CREATE POLICY "Allow username lookup for login"
  ON users FOR SELECT
  TO anon
  USING (true);
```

ูุฐู Policy **ูุคูุชุฉ ููุชุทููุฑ ููุท**. ูู ุงูุฅูุชุงุฌ ูุฌุจ ุงุณุชุจุฏุงููุง ุจู Database Function ููุชุณุฌูู ุงูุฏุฎูู.

## ุงูุฎุทูุงุช ุงูุชุงููุฉ ุจุนุฏ ุงูุฅุตูุงุญ

1. โ ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู ูุฌููุน ุงูุฃุฏูุงุฑ
2. โ ุงุฎุชุจุงุฑ ุตูุญุฉ ุงูููู ุงูุดุฎุตู (ุชุญุฏูุซ Email ู Phone)
3. โ ุงุฎุชุจุงุฑ Check-in/Check-out
4. ๐จ ุจูุงุก ุตูุญุงุช HR Admin
5. ๐จ ุจูุงุก ุตูุญุงุช Super Admin
