{
  "permissions": {
    "allow": [
      "Bash(git commit -m \"$(cat <<''EOF''\nfix: إضافة attendance_records إلى إصلاح RLS\n\n## المشكلة:\n- خطأ 42501 عند محاولة تسجيل حضور الموظف\n- new row violates row-level security policy for table \"attendance_records\"\n\n## السبب:\n- تم إصلاح qr_codes, color_codes, numeric_codes في الcommit السابق\n- لكن attendance_records لا يزال محمي بـ RLS\n- عند اختيار اللون الصحيح، يفشل INSERT في attendance_records\n\n## الحل:\n- إضافة attendance_records إلى قائمة الجداول المعطلة في RLS\n- تحديث Migration: 20251018_fix_rls_for_local_auth.sql\n- تحديث الدليل: FIX_MANAGER_DASHBOARD.md\n- تحديث السكريبت: apply-rls-fix-manager.ts\n\n## الملفات المعدلة:\n- supabase/migrations/20251018_fix_rls_for_local_auth.sql\n  * إضافة: ALTER TABLE attendance_records DISABLE ROW LEVEL SECURITY;\n  * إضافة: COMMENT توضيحي\n  \n- FIX_MANAGER_DASHBOARD.md\n  * تحديث العنوان ليشمل Employee Check-In\n  * إضافة attendance_records إلى الأوامر\n  * إضافة اختبار 2: Employee Check-In\n  * إضافة جدول الأمان البديل\n\n- scripts/apply-rls-fix-manager.ts\n  * تحديث الوصف ليشمل Employee Check-In\n  * إضافة خطوة 4️⃣ لتعطيل RLS على attendance_records\n  * تحديث الخطوات التالية\n  * إضافة الأمر في الحل البديل\n\n## النتيجة المتوقعة:\n✅ Manager Dashboard يعمل (QR/Color/Numeric codes)\n✅ Employee Check-In يعمل (تسجيل الحضور بالألوان)\n✅ لا أخطاء RLS\n\n🤖 Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>\nEOF\n)\")",
      "Bash(dir backup-data /b)",
      "Bash(git add backup-data/ scripts/backup-all-tables.ts)",
      "Bash(git commit -m \"$(cat <<''EOF''\nfeat: إضافة نظام النسخ الاحتياطي للبيانات\n\n## الإضافات الجديدة:\n\n### 1. سكريبت النسخ الاحتياطي\n- ✅ إنشاء `scripts/backup-all-tables.ts`\n- ✅ سحب جميع البيانات من 15 جدول\n- ✅ حفظ البيانات في ملفات JSON منفصلة\n- ✅ إنشاء تقرير شامل `_backup_summary.json`\n\n### 2. البيانات المحفوظة (197 صف)\n- companies: 2 صف\n- branches: 4 صف\n- locations: 7 صف\n- location_managers: 4 صف\n- users: 21 صف\n- employees: 10 صف\n- shifts: 9 صف\n- color_codes: 114 صف\n- numeric_codes: 23 صف\n- attendance_records: 2 صف\n- leave_requests: 1 صف\n\n### 3. ملفات التوثيق\n- ✅ `backup-data/README.md` - دليل شامل\n- ✅ `backup-data/TEST_ACCOUNTS.md` - حسابات الاختبار\n\n## الفوائد:\n\n1. **للاختبار:**\n   - بيانات واقعية جاهزة للاختبار\n   - حسابات معرّفة لجميع الأدوار\n   - سجلات حضور حقيقية\n\n2. **للتطوير:**\n   - فهم هيكل البيانات\n   - مرجع للعلاقات بين الجداول\n   - بيانات للتجربة والتطوير\n\n3. **للأمان:**\n   - نسخة احتياطية آمنة\n   - إمكانية استعادة البيانات\n   - توثيق كامل للبيانات الأولية\n\n## الاستخدام:\n\n```bash\n# إنشاء نسخة احتياطية جديدة\nnpx tsx scripts/backup-all-tables.ts\n```\n\n## الملفات:\n- scripts/backup-all-tables.ts\n- backup-data/*.json (15 ملف JSON)\n- backup-data/README.md\n- backup-data/TEST_ACCOUNTS.md\n\n🤖 Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>\nEOF\n)\")",
      "Bash(git add backup-data/DATABASE_SCHEMA.md)",
      "Bash(git commit -m \"docs: إضافة توثيق شامل لـ Database Schema\n\n- إضافة ملف DATABASE_SCHEMA.md\n- توثيق جميع الجداول (15 جدول)\n- شرح العلاقات بين الجداول\n- توضيح User-Defined Types\n- إحصائيات البيانات الحالية\n- حالة RLS لكل جدول\n\n🤖 Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>\")",
      "Bash(git add src/hooks/useUserLocationInfo.ts src/components/UserLocationDisplay.tsx src/pages/employee/EmployeeDashboard.tsx src/pages/employee/Profile.tsx src/pages/manager/ManagerDashboard.tsx src/pages/hr/HRDashboard.tsx src/pages/admin/AdminDashboard.tsx)",
      "Bash(git commit -m \"$(cat <<''EOF''\nfeat: إضافة عرض شامل لمعلومات الموقع (الشركة/الفرع/الموقع)\n\n## 🎯 الهدف:\nعرض معلومات كاملة ومتسقة عن الشركة والفرع والموقع في جميع لوحات التحكم\n\n## ✨ الإضافات الجديدة:\n\n### 1. Custom Hook: useUserLocationInfo\n- **المسار:** `src/hooks/useUserLocationInfo.ts`\n- **الوظيفة:** جلب بيانات كاملة للمستخدم (شركة، فرع، موقع/مواقع)\n- **المزايا:**\n  - دعم جميع الأدوار (employee, manager, hr, admin)\n  - للموظفين: جلب الموقع من جدول employees\n  - للمدراء: جلب جميع المواقع من location_managers\n  - للـ HR/Admin: جلب الشركة والفرع فقط\n  - معالجة البيانات المفقودة بذكاء\n\n### 2. Display Component: UserLocationDisplay\n- **المسار:** `src/components/UserLocationDisplay.tsx`\n- **الوظيفة:** عرض موحد لمعلومات الموقع\n- **الأنماط:**\n  - `inline`: عرض في سطر واحد (الشركة / الفرع / الموقع)\n  - `card`: عرض منفصل مع أيقونات (للملف الشخصي)\n- **المزايا:**\n  - دعم المدراء بعدة مواقع (يدير X مواقع)\n  - عرض \"غير محدد\" للبيانات المفقودة\n  - تصميم بسيط ومتسق\n\n## 📝 الصفحات المحدثة:\n\n### EmployeeDashboard\n- **التحديث:** استبدال عرض الموقع بالعرض الشامل\n- **قبل:** \"مكتب جدة\"\n- **بعد:** \"شركة التطوير التقني / الفرع الرئيسي / مكتب جدة\"\n- **الموقع:** Header العلوي\n\n### Profile (صفحة الملف الشخصي)\n- **الإضافة:** قسم جديد \"معلومات العمل\"\n- **المحتوى:**\n  - 🏢 الشركة\n  - 📂 الفرع\n  - 📍 الموقع/المواقع\n- **التصميم:** Card منفصل بعد بيانات المستخدم\n\n### ManagerDashboard\n- **التحديث:** عرض المواقع المتعددة\n- **للمدير بموقع واحد:** \"الشركة / الفرع / الموقع\"\n- **للمدير بعدة مواقع:** \"الشركة / الفرع / يدير 3 مواقع\"\n- **الموقع:** Header العلوي\n\n### HRDashboard\n- **الإضافة:** عرض الشركة والفرع\n- **الموقع:** أسفل \"مرحباً، {الاسم}\"\n- **التنسيق:** سطر إضافي بحجم نص صغير\n\n### AdminDashboard\n- **الإضافة:** عرض اسم الشركة\n- **الموقع:** أسفل \"مرحباً، {الاسم}\"\n- **الأيقونة:** 🏢 مع اسم الشركة\n\n## 🔧 التحسينات التقنية:\n\n1. **Type Safety:** جميع الواجهات محددة في TypeScript\n2. **Reusability:** Hook و Component قابلين لإعادة الاستخدام\n3. **Performance:** استعلامات محسّنة مع Supabase\n4. **Error Handling:** معالجة الأخطاء والبيانات المفقودة\n5. **Consistency:** عرض موحد عبر جميع الصفحات\n\n## 📊 الفوائد:\n\n- ✅ وضوح أكبر للمستخدم عن موقعه في الهيكل التنظيمي\n- ✅ تجربة مستخدم متسقة عبر جميع لوحات التحكم\n- ✅ دعم كامل للمدراء بعدة مواقع\n- ✅ كود نظيف وقابل للصيانة\n- ✅ تصميم بسيط كما هو مطلوب\n\n## 📁 الملفات المتأثرة:\n\n### ملفات جديدة (2):\n- `src/hooks/useUserLocationInfo.ts`\n- `src/components/UserLocationDisplay.tsx`\n\n### ملفات محدثة (5):\n- `src/pages/employee/EmployeeDashboard.tsx`\n- `src/pages/employee/Profile.tsx`\n- `src/pages/manager/ManagerDashboard.tsx`\n- `src/pages/hr/HRDashboard.tsx`\n- `src/pages/admin/AdminDashboard.tsx`\n\n🤖 Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>\nEOF\n)\")"
    ],
    "deny": [],
    "ask": []
  }
}
